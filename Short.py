# source code http://inaz2.hatenablog.com/entry/2016/01/20/022936
from Crypto.Util.number import long_to_bytes

def short_pad_attack(c1, c2, e, n):

    PRxy.<x,y> = PolynomialRing(Zmod(n))

    PRx.<xn> = PolynomialRing(Zmod(n))

    PRZZ.<xz,yz> = PolynomialRing(Zmod(n))

    g1 = x^e - c1

    g2 = (x+y)^e - c2

    q1 = g1.change_ring(PRZZ)

    q2 = g2.change_ring(PRZZ)

    h = q2.resultant(q1)

    h = h.univariate_polynomial()

    h = h.change_ring(PRx).subs(y=xn)

    h = h.monic()

    kbits = n.nbits()//(2*e*e)

    diff = h.small_roots(X=2^kbits, beta=0.5)[0]  # find root < 2^kbits with factor >= n^0.5

    return diff

def related_message_attack(c1, c2, diff, e, n):

    PRx.<x> = PolynomialRing(Zmod(n))

    g1 = x^e - c1

    g2 = (x+diff)^e - c2

    def gcd(g1, g2):

        while g2:

            g1, g2 = g2, g1 % g2

        return g1.monic()

    return -gcd(g1, g2)[0]

if __name__ == '__main__':

    n =112776255070151149018976975445658442171845354409777530022379532366604970277226789066648779189149761132124515176259689574339853694909561212361111861217117319549180223575405784846848693749510515937872813868630658378953004734097428096186763439584537150836335014386972131805105416963845692809537761147309853949743
    C1 = 35242680733320668861453970448886143996733785144439357976699579444220935678185326835998855833093133021453434361787943291804964088148454127104032556798641978761012889005438545418970362333595364972955886018447299678120687965828427516438253092039576371453943404459662827387106697905912201948543599575399875647942
    C2 = 80408611718153805441609390165757812183153789461285120207023887229828944279233999863045783934825265236617810634251465239793684804369375464903295909535304503084311069214614207393401050847104867813555167714770487340935502812338005343323529661302864803907786380995300296924219523313184704471577195408420333735331
    e = 3


    diff = short_pad_attack(C1, C2, e, n)

    m = related_message_attack(C1, C2, diff, e, n)

    M = long_to_bytes(int(m))

print (M)